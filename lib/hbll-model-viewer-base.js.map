{"version":3,"file":"hbll-model-viewer-base.js","sourceRoot":"","sources":["../src/hbll-model-viewer-base.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  html,\r\n  LitElement,\r\n  property,\r\n  css,\r\n  query,\r\n  internalProperty,\r\n} from \"lit-element\";\r\nimport {\r\n  urlFromUnzippedFile,\r\n  jsonFromFile,\r\n  getJsonFromUrl,\r\n  gettextFromFile,\r\n} from \"./file-utils.js\";\r\nimport { AnnotationData, Annotation, Manifest } from \"./types/annotations.js\";\r\nimport { Marked } from \"@ts-stack/markdown\";\r\nimport { styles } from \"./hbll-model-viewer-base.css.js\";\r\n\r\nconst map_style = {\r\n  height: \"100vh\",\r\n  width: \"100%\",\r\n};\r\n\r\nexport default class HbllModelViewerElementBase extends LitElement {\r\n  @query(\"model-viewer\") readonly modelViewer?: any;\r\n  @query(\"a\") readonly downloader?: any;\r\n  @property({ type: String }) src: string | null = null;\r\n  @property({ type: String }) annotation_src: string | null = null;\r\n  @property({ type: String }) skybox_image: string | null = null;\r\n  @property() annotations: AnnotationData | null = null;\r\n  @property() manifest_src: string | null = null;\r\n\r\n  @internalProperty()\r\n  cameraIsDirty: boolean;\r\n\r\n  @internalProperty()\r\n  currentAnnotation: Annotation | undefined;\r\n\r\n  @internalProperty()\r\n  buttonStyles: any;\r\n\r\n  @internalProperty()\r\n  files: Map<string, string>;\r\n\r\n  @internalProperty()\r\n  manifest: Manifest | null = null;\r\n\r\n  constructor() {\r\n    super();\r\n    this.cameraIsDirty = false;\r\n    this.currentAnnotation = undefined;\r\n    this.files = new Map<string, string>();\r\n  }\r\n\r\n  async firstUpdated() {\r\n    // Give the browser a chance to paint\r\n    await new Promise((r) => setTimeout(r, 0));\r\n\r\n    if (this.annotation_src != undefined) {\r\n      this.annotations = await getJsonFromUrl(this.annotation_src);\r\n    }\r\n\r\n    if (this.manifest_src != undefined) {\r\n      this.manifest = await getJsonFromUrl(this.manifest_src);\r\n      if (this.manifest?.entries != undefined)\r\n        for (let i = 0; i < this.manifest?.entries.length || 0; i++) {\r\n          let text = await gettextFromFile(this.manifest?.entries[i].url);\r\n          if (text != undefined)\r\n            this.files.set(this.manifest?.entries[i].name, text);\r\n        }\r\n    }\r\n    this.addEventListener(\"drop\", this.onDrop);\r\n    this.addEventListener(\"dragover\", this.onDragover);\r\n  }\r\n\r\n  private onDragover(event: DragEvent) {\r\n    if (!event.dataTransfer) return;\r\n\r\n    event.stopPropagation();\r\n    event.preventDefault();\r\n  }\r\n\r\n  private async onDrop(event: DragEvent) {\r\n    event.stopPropagation();\r\n    event.preventDefault();\r\n\r\n    if (event.dataTransfer && event.dataTransfer.items[0].kind === \"file\") {\r\n      const file = event.dataTransfer.items[0].getAsFile();\r\n      if (!file) return;\r\n      if (file.name.match(/\\.(glb)$/i)) {\r\n        this.src = await urlFromUnzippedFile(file);\r\n      }\r\n      if (file.name.match(/\\.(hdr|png|jpg|jpeg)$/i)) {\r\n        this.skybox_image = await urlFromUnzippedFile(file);\r\n      }\r\n      if (file.name.match(/\\.(json)$/i)) {\r\n        if (file.name === \"manifest.json\") {\r\n          this.manifest = await jsonFromFile(file);\r\n        }\r\n        this.annotations = await jsonFromFile(file);\r\n        // console.log(this.annotations);\r\n      }\r\n      if (file.name.match(/\\.(zip)$/i)) {\r\n        console.log(\"Dropped a zipped file\");\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleClick(event: MouseEvent) {\r\n    this.modelViewer.cameraTarget = `auto auto auto`;\r\n    if (!this.cameraIsDirty) {\r\n      if (!this.modelViewer) {\r\n        throw new Error(\"Model Viewer doesn't exist\");\r\n      }\r\n      const rect = this.modelViewer.getBoundingClientRect();\r\n      const x = event.clientX - rect.left;\r\n      const y = event.clientY - rect.top;\r\n      const positionAndNormal = this.modelViewer.positionAndNormalFromPoint(\r\n        x,\r\n        y\r\n      );\r\n      this.requestUpdate();\r\n      if (!positionAndNormal) {\r\n        throw new Error(\"invalid click position\");\r\n      }\r\n    } else this.cameraIsDirty = false;\r\n  }\r\n\r\n  private cameraMoved() {\r\n    this.cameraIsDirty = true;\r\n  }\r\n\r\n  private saveAnnotations() {\r\n    let blob = new Blob([JSON.stringify(this.annotations)], {\r\n        type: \"text/plain;charset=utf-8\",\r\n      }),\r\n      url = window.URL.createObjectURL(blob);\r\n    this.downloader.href = url;\r\n    this.downloader.download = \"annotations.json\";\r\n    this.downloader.click();\r\n    window.URL.revokeObjectURL(url);\r\n  }\r\n\r\n  private saveCameraOrbit() {\r\n    // console.log(JSON.stringify(this.modelViewer.getCameraOrbit()));\r\n    let blob = new Blob([JSON.stringify(this.modelViewer.getCameraOrbit())], {\r\n        type: \"text/plain;charset=utf-8\",\r\n      }),\r\n      url = window.URL.createObjectURL(blob);\r\n    this.downloader.href = url;\r\n    this.downloader.download = \"camera_orbit.json\";\r\n    this.downloader.click();\r\n    window.URL.revokeObjectURL(url);\r\n  }\r\n\r\n  private annotationClick(annotation: Annotation | undefined) {\r\n    // console.log(annotation);\r\n    this.currentAnnotation = annotation;\r\n    if (annotation == undefined) return;\r\n    this.modelViewer.cameraTarget = `${annotation.position.x || \"auto\"}m ${\r\n      annotation.position.y || \"auto\"\r\n    }m ${annotation.position.z || \"auto\"}m`;\r\n    this.modelViewer.cameraOrbit = `${annotation.cameraOrbit.theta}rad ${annotation.cameraOrbit.phi}rad ${annotation.cameraOrbit.radius}m`;\r\n    this.requestUpdate();\r\n  }\r\n\r\n  private no_model_msg() {\r\n    return html`<div slot=\"poster\" class=\"drag_drop_text unselectable\">\r\n      Drag and drop a model here!<br />\r\n      <small class=\"unselectable\">Add an HDR for environment</small>\r\n    </div>`;\r\n  }\r\n\r\n  private nav_label() {\r\n    return html`<div class=\"label_nav grid-container\">\r\n      <div @click=${(e) => {\r\n        this.previousAnnotaion();\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n      }} class=\"round nav_arrow nav_prev unselectable\">&#8249;</div>\r\n      <div class=\"annotation_label unselectable nav_center\">\r\n        ${this.currentAnnotation?.name || \"Select an annotion\"}\r\n        </div>\r\n        <div @click=${(e) => {\r\n          this.nextAnnotaion();\r\n          e.stopPropagation();\r\n          e.preventDefault();\r\n        }} class=\"round nav_arrow nav_next unselectable\">&#8250;</div>\r\n      </div>\r\n    </div>`;\r\n  }\r\n\r\n  private nextAnnotaion() {\r\n    if (this.currentAnnotation == undefined) {\r\n      this.annotationClick(this.annotations?.annotations[0]);\r\n      this.shadowRoot\r\n        ?.getElementById(\r\n          \"hotspot-\" + this.annotations?.annotations[0]?.name || \"rand\"\r\n        )\r\n        ?.focus();\r\n    } else {\r\n      if (this.annotations != undefined) {\r\n        let index = this.annotations.annotations.indexOf(\r\n          this.currentAnnotation\r\n        );\r\n        this.annotationClick(\r\n          this.annotations.annotations[\r\n            (index + 1) % this.annotations.annotations.length\r\n          ]\r\n        );\r\n        this.shadowRoot\r\n          ?.getElementById(\"hotspot-\" + this.currentAnnotation?.name || \"rand\")\r\n          ?.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n  private previousAnnotaion() {\r\n    if (this.currentAnnotation == undefined) {\r\n      this.annotationClick(this.annotations?.annotations[0]);\r\n      this.shadowRoot\r\n        ?.getElementById(\r\n          \"hotspot-\" + this.annotations?.annotations[0]?.name || \"rand\"\r\n        )\r\n        ?.focus();\r\n    } else {\r\n      if (this.annotations != undefined) {\r\n        let index = this.annotations.annotations.indexOf(\r\n          this.currentAnnotation\r\n        );\r\n        this.annotationClick(\r\n          this.annotations.annotations[\r\n            index - 1 < 0 ? this.annotations.annotations.length - 1 : index - 1\r\n          ]\r\n        );\r\n        this.shadowRoot\r\n          ?.getElementById(\"hotspot-\" + this.currentAnnotation?.name || \"rand\")\r\n          ?.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n  static get styles() {\r\n    return styles;\r\n  }\r\n\r\n  returnString(str: string) {\r\n    var frag = document.createRange().createContextualFragment(`${str}`);\r\n    return frag;\r\n  }\r\n\r\n  private getAnnotationDescription(annotation: Annotation) {\r\n    let text =\r\n      annotation.descriptionFileName != undefined\r\n        ? this.files.get(annotation.descriptionFileName)\r\n        : annotation.description;\r\n\r\n    return html`${(annotation.markdown || false) == true\r\n      ? html`${this.returnString(Marked.parse(text || \"\"))}`\r\n      : text}`;\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      <a id=\"download\"></a>\r\n      <model-viewer\r\n        style=${map_style}\r\n        src=${this.src || \"\"}\r\n        skybox-image=${this.skybox_image || \"\"}\r\n        camera-controls\r\n        @click=\"${this.handleClick},\"\r\n        @camera-change=${this.cameraMoved}\r\n      >\r\n        <style>\r\n          ${this.annotations?.annotations?.map(\r\n            (i, index) => html` button[slot=\"hotspot-${i.name || \"random\"}\"] {\r\n            background: ${i.fill_color || \"#FFFFFFFF\"}; }`\r\n          )};\r\n        </style>\r\n        ${this.annotations?.annotations?.map(\r\n          (i, index) =>\r\n            html`<button\r\n              id=\"hotspot-${i.name || \"rand\"}\"\r\n              @click=${(e: Event) => {\r\n                this.annotationClick(i);\r\n                e.stopPropagation();\r\n                e.preventDefault();\r\n              }}\r\n              slot=\"hotspot-${i.name || \"rand\"}\"\r\n              data-position=\"${i.position.x} ${i.position.y} ${i.position.z}\"\r\n              data-normal=\"${i.normal.x} ${i.normal.y} ${i.normal.z}\"\r\n              data-visibility-attribute=\"visible\"\r\n            >\r\n              ${index + 1}\r\n              <div class=\"HotspotAnnotation\">\r\n                <div class=\"annotation_description\">\r\n                  ${this.getAnnotationDescription(i)}\r\n                </div>\r\n              </div>\r\n            </button>`\r\n        )}\r\n        ${this.src == undefined && this.annotations == undefined\r\n          ? html``\r\n          : this.nav_label()}\r\n        ${this.annotations == undefined && this.src == undefined\r\n          ? this.no_model_msg()\r\n          : html``}\r\n      </model-viewer>\r\n    `;\r\n  }\r\n}\r\n"]}